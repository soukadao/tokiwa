{
  "version": 3,
  "sources": ["../../src/core/errors.ts", "../../src/core/logger.ts", "../../src/cron/cron.ts", "../../src/cron/leader-scheduler.ts", "../../src/cron/scheduler.ts"],
  "sourcesContent": ["/**\n * \u30A2\u30D7\u30EA\u30B1\u30FC\u30B7\u30E7\u30F3\u5171\u901A\u306E\u57FA\u5E95\u30A8\u30E9\u30FC\u30AF\u30E9\u30B9\n * \u30B5\u30D6\u30AF\u30E9\u30B9\u540D\u3092\u81EA\u52D5\u7684\u306Bname\u30D7\u30ED\u30D1\u30C6\u30A3\u306B\u8A2D\u5B9A\u3059\u308B\n */\nexport class AppError extends Error {\n  /**\n   * @param message \u30A8\u30E9\u30FC\u30E1\u30C3\u30BB\u30FC\u30B8\n   * @param options \u30A8\u30E9\u30FC\u30AA\u30D7\u30B7\u30E7\u30F3\uFF08cause\u306A\u3069\uFF09\n   */\n  constructor(message: string, options: ErrorOptions = {}) {\n    super(message, options);\n    this.name = this.constructor.name;\n  }\n}\n\n/** \u7121\u52B9\u306A\u5F15\u6570\u304C\u6E21\u3055\u308C\u305F\u5834\u5408\u306E\u30A8\u30E9\u30FC */\nexport class InvalidArgumentError extends AppError {}\n\n/** \u5B9F\u884C\u6642\u30A8\u30E9\u30FC */\nexport class RuntimeError extends AppError {}\n\n/** \u30EA\u30BD\u30FC\u30B9\u304C\u898B\u3064\u304B\u3089\u306A\u3044\u5834\u5408\u306E\u30A8\u30E9\u30FC */\nexport class NotFoundError extends AppError {}\n\n/** \u30EA\u30BD\u30FC\u30B9\u306E\u7AF6\u5408\u304C\u767A\u751F\u3057\u305F\u5834\u5408\u306E\u30A8\u30E9\u30FC */\nexport class ConflictError extends AppError {}\n\n/** \u4E0D\u6B63\u306A\u72B6\u614B\u3067\u64CD\u4F5C\u304C\u5B9F\u884C\u3055\u308C\u305F\u5834\u5408\u306E\u30A8\u30E9\u30FC */\nexport class StateError extends AppError {}\n\n/** \u4F9D\u5B58\u95A2\u4FC2\u306B\u554F\u984C\u304C\u3042\u308B\u5834\u5408\u306E\u30A8\u30E9\u30FC */\nexport class DependencyError extends AppError {}\n\n/** \u5FAA\u74B0\u4F9D\u5B58\u304C\u691C\u51FA\u3055\u308C\u305F\u5834\u5408\u306E\u30A8\u30E9\u30FC */\nexport class CyclicDependencyError extends DependencyError {}\n\n/** \u30B7\u30EA\u30A2\u30E9\u30A4\u30BA/\u30C7\u30B7\u30EA\u30A2\u30E9\u30A4\u30BA\u306B\u5931\u6557\u3057\u305F\u5834\u5408\u306E\u30A8\u30E9\u30FC */\nexport class SerializationError extends AppError {}\n", "export const LOG_LEVEL = {\n  emergency: 0,\n  alert: 1,\n  critical: 2,\n  error: 3,\n  warning: 4,\n  notice: 5,\n  info: 6,\n  debug: 7,\n} as const;\n\nexport type LogLevel = keyof typeof LOG_LEVEL;\n\nexport interface LogEntry {\n  level: LogLevel;\n  message: string;\n  timestamp: Date;\n  context?: Record<string, unknown>;\n}\n\nexport type LogSink = (entry: LogEntry) => void;\n\nexport interface LoggerOptions {\n  level?: LogLevel;\n  sink?: LogSink;\n}\n\nconst DEFAULT_LOG_LEVEL: LogLevel = \"info\";\nconst UNSERIALIZABLE_PLACEHOLDER = \"[Unserializable]\";\n\nconst LEVEL_METHOD_MAP: Record<\n  LogLevel,\n  \"debug\" | \"info\" | \"warn\" | \"error\" | \"log\"\n> = {\n  emergency: \"error\",\n  alert: \"error\",\n  critical: \"error\",\n  error: \"error\",\n  warning: \"warn\",\n  notice: \"info\",\n  info: \"info\",\n  debug: \"debug\",\n};\n\nconst safeStringify = (value: unknown): string => {\n  try {\n    return JSON.stringify(value);\n  } catch {\n    return UNSERIALIZABLE_PLACEHOLDER;\n  }\n};\n\nconst createDefaultSink = (): LogSink => {\n  return (entry: LogEntry): void => {\n    const method = LEVEL_METHOD_MAP[entry.level];\n    const timestamp = entry.timestamp.toISOString();\n    const contextText = entry.context ? ` ${safeStringify(entry.context)}` : \"\";\n    console[method](\n      `[${timestamp}] ${entry.level}: ${entry.message}${contextText}`,\n    );\n  };\n};\n\n/**\n * \u30EC\u30D9\u30EB\u4ED8\u304D\u30ED\u30AC\u30FC\n * \u30B7\u30F3\u30AF\uFF08\u51FA\u529B\u5148\uFF09\u3092\u5DEE\u3057\u66FF\u3048\u53EF\u80FD\u3067\u3001\u30EC\u30D9\u30EB\u306B\u3088\u308B\u30D5\u30A3\u30EB\u30BF\u30EA\u30F3\u30B0\u3092\u884C\u3046\n */\nexport class Logger {\n  private level: LogLevel = DEFAULT_LOG_LEVEL;\n  private levelValue: number = LOG_LEVEL[DEFAULT_LOG_LEVEL];\n  private sink: LogSink = createDefaultSink();\n\n  /**\n   * @param options \u30ED\u30B0\u30EC\u30D9\u30EB\u3084\u30B7\u30F3\u30AF\u306E\u8A2D\u5B9A\n   */\n  constructor(options: LoggerOptions = {}) {\n    if (options.level) {\n      this.setLevel(options.level);\n    }\n    if (options.sink) {\n      this.setSink(options.sink);\n    }\n  }\n\n  /**\n   * \u30ED\u30B0\u30EC\u30D9\u30EB\u3092\u5909\u66F4\u3059\u308B\n   * @param level \u65B0\u3057\u3044\u30ED\u30B0\u30EC\u30D9\u30EB\n   */\n  setLevel(level: LogLevel): void {\n    this.level = level;\n    this.levelValue = LOG_LEVEL[level];\n  }\n\n  /**\n   * \u73FE\u5728\u306E\u30ED\u30B0\u30EC\u30D9\u30EB\u3092\u8FD4\u3059\n   * @returns \u73FE\u5728\u306E\u30ED\u30B0\u30EC\u30D9\u30EB\n   */\n  getLevel(): LogLevel {\n    return this.level;\n  }\n\n  /**\n   * \u30ED\u30B0\u51FA\u529B\u5148\uFF08\u30B7\u30F3\u30AF\uFF09\u3092\u5909\u66F4\u3059\u308B\n   * @param sink \u65B0\u3057\u3044\u30ED\u30B0\u30B7\u30F3\u30AF\n   */\n  setSink(sink: LogSink): void {\n    this.sink = sink;\n  }\n\n  /**\n   * \u6307\u5B9A\u30EC\u30D9\u30EB\u3067\u30ED\u30B0\u3092\u8A18\u9332\u3059\u308B\u3002\u73FE\u5728\u306E\u30EC\u30D9\u30EB\u4EE5\u4E0B\u306E\u5834\u5408\u306E\u307F\u51FA\u529B\u3055\u308C\u308B\n   * @param level \u30ED\u30B0\u30EC\u30D9\u30EB\n   * @param message \u30ED\u30B0\u30E1\u30C3\u30BB\u30FC\u30B8\n   * @param context \u8FFD\u52A0\u306E\u30B3\u30F3\u30C6\u30AD\u30B9\u30C8\u60C5\u5831\n   */\n  log(\n    level: LogLevel,\n    message: string,\n    context?: Record<string, unknown>,\n  ): void {\n    if (LOG_LEVEL[level] > this.levelValue) {\n      return;\n    }\n    this.sink({ level, message, timestamp: new Date(), context });\n  }\n\n  /**\n   * emergency\u30EC\u30D9\u30EB\u306E\u30ED\u30B0\u3092\u8A18\u9332\u3059\u308B\n   * @param message \u30ED\u30B0\u30E1\u30C3\u30BB\u30FC\u30B8\n   * @param context \u8FFD\u52A0\u306E\u30B3\u30F3\u30C6\u30AD\u30B9\u30C8\u60C5\u5831\n   */\n  emergency(message: string, context?: Record<string, unknown>): void {\n    this.log(\"emergency\", message, context);\n  }\n\n  /**\n   * alert\u30EC\u30D9\u30EB\u306E\u30ED\u30B0\u3092\u8A18\u9332\u3059\u308B\n   * @param message \u30ED\u30B0\u30E1\u30C3\u30BB\u30FC\u30B8\n   * @param context \u8FFD\u52A0\u306E\u30B3\u30F3\u30C6\u30AD\u30B9\u30C8\u60C5\u5831\n   */\n  alert(message: string, context?: Record<string, unknown>): void {\n    this.log(\"alert\", message, context);\n  }\n\n  /**\n   * critical\u30EC\u30D9\u30EB\u306E\u30ED\u30B0\u3092\u8A18\u9332\u3059\u308B\n   * @param message \u30ED\u30B0\u30E1\u30C3\u30BB\u30FC\u30B8\n   * @param context \u8FFD\u52A0\u306E\u30B3\u30F3\u30C6\u30AD\u30B9\u30C8\u60C5\u5831\n   */\n  critical(message: string, context?: Record<string, unknown>): void {\n    this.log(\"critical\", message, context);\n  }\n\n  /**\n   * error\u30EC\u30D9\u30EB\u306E\u30ED\u30B0\u3092\u8A18\u9332\u3059\u308B\n   * @param message \u30ED\u30B0\u30E1\u30C3\u30BB\u30FC\u30B8\n   * @param context \u8FFD\u52A0\u306E\u30B3\u30F3\u30C6\u30AD\u30B9\u30C8\u60C5\u5831\n   */\n  error(message: string, context?: Record<string, unknown>): void {\n    this.log(\"error\", message, context);\n  }\n\n  /**\n   * warning\u30EC\u30D9\u30EB\u306E\u30ED\u30B0\u3092\u8A18\u9332\u3059\u308B\n   * @param message \u30ED\u30B0\u30E1\u30C3\u30BB\u30FC\u30B8\n   * @param context \u8FFD\u52A0\u306E\u30B3\u30F3\u30C6\u30AD\u30B9\u30C8\u60C5\u5831\n   */\n  warning(message: string, context?: Record<string, unknown>): void {\n    this.log(\"warning\", message, context);\n  }\n\n  /**\n   * notice\u30EC\u30D9\u30EB\u306E\u30ED\u30B0\u3092\u8A18\u9332\u3059\u308B\n   * @param message \u30ED\u30B0\u30E1\u30C3\u30BB\u30FC\u30B8\n   * @param context \u8FFD\u52A0\u306E\u30B3\u30F3\u30C6\u30AD\u30B9\u30C8\u60C5\u5831\n   */\n  notice(message: string, context?: Record<string, unknown>): void {\n    this.log(\"notice\", message, context);\n  }\n\n  /**\n   * info\u30EC\u30D9\u30EB\u306E\u30ED\u30B0\u3092\u8A18\u9332\u3059\u308B\n   * @param message \u30ED\u30B0\u30E1\u30C3\u30BB\u30FC\u30B8\n   * @param context \u8FFD\u52A0\u306E\u30B3\u30F3\u30C6\u30AD\u30B9\u30C8\u60C5\u5831\n   */\n  info(message: string, context?: Record<string, unknown>): void {\n    this.log(\"info\", message, context);\n  }\n\n  /**\n   * debug\u30EC\u30D9\u30EB\u306E\u30ED\u30B0\u3092\u8A18\u9332\u3059\u308B\n   * @param message \u30ED\u30B0\u30E1\u30C3\u30BB\u30FC\u30B8\n   * @param context \u8FFD\u52A0\u306E\u30B3\u30F3\u30C6\u30AD\u30B9\u30C8\u60C5\u5831\n   */\n  debug(message: string, context?: Record<string, unknown>): void {\n    this.log(\"debug\", message, context);\n  }\n}\n/**\n * \u65B0\u3057\u3044Logger\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u3092\u751F\u6210\u3059\u308B\u30D5\u30A1\u30AF\u30C8\u30EA\u95A2\u6570\n * @param options \u30ED\u30B0\u30EC\u30D9\u30EB\u3084\u30B7\u30F3\u30AF\u306E\u8A2D\u5B9A\n * @returns \u65B0\u3057\u3044Logger\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\n */\nexport const createLogger = (options: LoggerOptions = {}): Logger =>\n  new Logger(options);\n", "import { InvalidArgumentError, RuntimeError } from \"../core/index.js\";\n\n/**\n * Parsed cron fields in local time.\n * dayOfWeek uses 0 (Sunday) through 6 (Saturday).\n */\ninterface CronFields {\n  minute: number[];\n  hour: number[];\n  dayOfMonth: number[];\n  month: number[];\n  dayOfWeek: number[];\n}\n\ntype CronFieldKey = keyof CronFields;\n\ninterface CronFieldSpec {\n  key: CronFieldKey;\n  min: number;\n  max: number;\n}\n\nconst CRON_FIELD_SPECS: ReadonlyArray<CronFieldSpec> = [\n  { key: \"minute\", min: 0, max: 59 },\n  { key: \"hour\", min: 0, max: 23 },\n  { key: \"dayOfMonth\", min: 1, max: 31 },\n  { key: \"month\", min: 1, max: 12 },\n  { key: \"dayOfWeek\", min: 0, max: 6 },\n];\n\nconst CRON_FIELD_COUNT = CRON_FIELD_SPECS.length;\nconst BASE_10 = 10;\nconst MIN_STEP_VALUE = 1;\nconst DEFAULT_RANGE_STEP = 1;\nconst NEXT_MINUTE_INCREMENT = 1;\nconst NEXT_HOUR_INCREMENT = 1;\nconst NEXT_DAY_INCREMENT = 1;\nconst NEXT_YEAR_INCREMENT = 1;\nconst MONTH_OFFSET = 1;\nconst RESET_HOURS = 0;\nconst RESET_MINUTES = 0;\nconst RESET_SECONDS = 0;\nconst RESET_MILLISECONDS = 0;\nconst LOOKAHEAD_YEARS = 4;\nconst DAYS_PER_YEAR = 365;\nconst HOURS_PER_DAY = 24;\nconst MINUTES_PER_HOUR = 60;\nconst CRON_MAX_ITERATIONS =\n  LOOKAHEAD_YEARS * DAYS_PER_YEAR * HOURS_PER_DAY * MINUTES_PER_HOUR;\n\n/**\n * Parses a 5-field cron expression and evaluates dates in local time.\n */\nexport class Cron {\n  private static readonly MAX_ITERATIONS = CRON_MAX_ITERATIONS;\n  private readonly fields: CronFields;\n\n  /**\n   * @param expression minute hour dayOfMonth month dayOfWeek\n   */\n  constructor(expression: string) {\n    this.fields = this.parse(expression);\n  }\n\n  /**\n   * 5\u30D5\u30A3\u30FC\u30EB\u30C9\u306Ecron\u5F0F\u3092\u30D1\u30FC\u30B9\u3057\u3001CronFields\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\u306B\u5909\u63DB\u3059\u308B\u3002\n   * @param expression \u30B9\u30DA\u30FC\u30B9\u533A\u5207\u308A\u306Ecron\u5F0F\u6587\u5B57\u5217\n   * @returns \u30D1\u30FC\u30B9\u6E08\u307F\u306ECronFields\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\n   */\n  private parse(expression: string): CronFields {\n    const parts = expression.trim().split(/\\s+/);\n\n    if (parts.length !== CRON_FIELD_COUNT) {\n      throw new InvalidArgumentError(\n        \"Cron expression must have exactly 5 fields\",\n      );\n    }\n\n    const fields: Record<CronFieldKey, number[]> = {\n      minute: [],\n      hour: [],\n      dayOfMonth: [],\n      month: [],\n      dayOfWeek: [],\n    };\n\n    CRON_FIELD_SPECS.forEach((spec, index) => {\n      fields[spec.key] = this.parseField(parts[index], spec.min, spec.max);\n    });\n\n    return fields;\n  }\n\n  /**\n   * \u5358\u4E00\u30D5\u30A3\u30FC\u30EB\u30C9\u3092\u30D1\u30FC\u30B9\u3059\u308B\u3002\u30EF\u30A4\u30EB\u30C9\u30AB\u30FC\u30C9(*)\u3001\u7BC4\u56F2\u3001\u30B9\u30C6\u30C3\u30D7\u3001\u30AB\u30F3\u30DE\u533A\u5207\u308A\u306B\u5BFE\u5FDC\u3059\u308B\u3002\n   * @param field \u30D1\u30FC\u30B9\u5BFE\u8C61\u306E\u30D5\u30A3\u30FC\u30EB\u30C9\u6587\u5B57\u5217\n   * @param min \u30D5\u30A3\u30FC\u30EB\u30C9\u306E\u6700\u5C0F\u8A31\u5BB9\u5024\n   * @param max \u30D5\u30A3\u30FC\u30EB\u30C9\u306E\u6700\u5927\u8A31\u5BB9\u5024\n   * @returns \u30BD\u30FC\u30C8\u6E08\u307F\u306E\u8A31\u5BB9\u5024\u914D\u5217\n   */\n  private parseField(field: string, min: number, max: number): number[] {\n    if (field === \"*\") {\n      return this.buildRange(min, max);\n    }\n\n    const values = new Set<number>();\n    const parts = field.split(\",\");\n\n    for (const part of parts) {\n      this.parseFieldPart(part, min, max, values);\n    }\n\n    return this.sortedValues(values);\n  }\n\n  /**\n   * \u30AB\u30F3\u30DE\u533A\u5207\u308A\u30D5\u30A3\u30FC\u30EB\u30C9\u306E1\u30D1\u30FC\u30C8\u3092\u30D1\u30FC\u30B9\u3057\u3001\u5024\u3092\u30BB\u30C3\u30C8\u306B\u8FFD\u52A0\u3059\u308B\u3002\n   * \u30B9\u30C6\u30C3\u30D7\u5F0F(/)\u3001\u7BC4\u56F2\u5F0F(-)\u3001\u5358\u4E00\u5024\u306E\u3044\u305A\u308C\u304B\u3092\u51E6\u7406\u3059\u308B\u3002\n   * @param part \u30D1\u30FC\u30B9\u5BFE\u8C61\u306E\u30D1\u30FC\u30C8\u6587\u5B57\u5217\n   * @param min \u30D5\u30A3\u30FC\u30EB\u30C9\u306E\u6700\u5C0F\u8A31\u5BB9\u5024\n   * @param max \u30D5\u30A3\u30FC\u30EB\u30C9\u306E\u6700\u5927\u8A31\u5BB9\u5024\n   * @param values \u30D1\u30FC\u30B9\u7D50\u679C\u3092\u683C\u7D0D\u3059\u308B\u30BB\u30C3\u30C8\n   */\n  private parseFieldPart(\n    part: string,\n    min: number,\n    max: number,\n    values: Set<number>,\n  ): void {\n    if (part.includes(\"/\")) {\n      const [range, step] = part.split(\"/\");\n      const stepValue = this.parseStepValue(step);\n      const { start, end } = this.parseStepRange(range, min, max);\n      this.addRange(values, start, end, stepValue, min, max);\n      return;\n    }\n\n    if (part.includes(\"-\")) {\n      const [start, end] = part.split(\"-\");\n      const startValue = parseInt(start, BASE_10);\n      const endValue = parseInt(end, BASE_10);\n\n      if (Number.isNaN(startValue) || Number.isNaN(endValue)) {\n        throw new InvalidArgumentError(`Invalid range: ${part}`);\n      }\n\n      if (startValue < min || endValue > max || startValue > endValue) {\n        throw new InvalidArgumentError(`Range out of bounds: ${part}`);\n      }\n\n      this.addRange(values, startValue, endValue, DEFAULT_RANGE_STEP, min, max);\n      return;\n    }\n\n    const value = parseInt(part, BASE_10);\n\n    if (Number.isNaN(value)) {\n      throw new InvalidArgumentError(`Invalid value: ${part}`);\n    }\n\n    if (value < min || value > max) {\n      throw new InvalidArgumentError(\n        `Value out of bounds: ${value} (must be between ${min} and ${max})`,\n      );\n    }\n\n    values.add(value);\n  }\n\n  /**\n   * \u30B9\u30C6\u30C3\u30D7\u5024\u3092\u30D1\u30FC\u30B9\u3057\u3001\u6709\u52B9\u306A\u6B63\u306E\u6574\u6570\u3067\u3042\u308B\u3053\u3068\u3092\u691C\u8A3C\u3059\u308B\u3002\n   * @param step \u30B9\u30C6\u30C3\u30D7\u5024\u306E\u6587\u5B57\u5217\n   * @returns \u30D1\u30FC\u30B9\u6E08\u307F\u306E\u30B9\u30C6\u30C3\u30D7\u5024\n   * @throws {InvalidArgumentError} \u30B9\u30C6\u30C3\u30D7\u5024\u304C\u7121\u52B9\u307E\u305F\u306F1\u672A\u6E80\u306E\u5834\u5408\n   */\n  private parseStepValue(step: string): number {\n    const stepValue = parseInt(step, BASE_10);\n\n    if (Number.isNaN(stepValue) || stepValue < MIN_STEP_VALUE) {\n      throw new InvalidArgumentError(`Invalid step value: ${step}`);\n    }\n\n    return stepValue;\n  }\n\n  /**\n   * \u30B9\u30C6\u30C3\u30D7\u5F0F\u306E\u7BC4\u56F2\u90E8\u5206\u3092\u30D1\u30FC\u30B9\u3059\u308B\u3002*(\u5168\u7BC4\u56F2)\u3001\u6570\u5024-\u6570\u5024(\u660E\u793A\u7BC4\u56F2)\u3001\u5358\u4E00\u6570\u5024(\u958B\u59CB\u5024\u306E\u307F)\u306B\u5BFE\u5FDC\u3059\u308B\u3002\n   * @param range \u7BC4\u56F2\u6587\u5B57\u5217\uFF08\u4F8B: \"*\", \"1-5\", \"3\"\uFF09\n   * @param min \u30D5\u30A3\u30FC\u30EB\u30C9\u306E\u6700\u5C0F\u8A31\u5BB9\u5024\n   * @param max \u30D5\u30A3\u30FC\u30EB\u30C9\u306E\u6700\u5927\u8A31\u5BB9\u5024\n   * @returns \u958B\u59CB\u5024\u3068\u7D42\u4E86\u5024\u3092\u542B\u3080\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\n   */\n  private parseStepRange(\n    range: string,\n    min: number,\n    max: number,\n  ): { start: number; end: number } {\n    if (range === \"*\") {\n      return { start: min, end: max };\n    }\n\n    if (range.includes(\"-\")) {\n      const [start, end] = range.split(\"-\");\n      const startValue = this.parseBoundedValue(start, min, max, range);\n      const endValue = this.parseBoundedValue(end, min, max, range);\n\n      if (startValue > endValue) {\n        throw new InvalidArgumentError(`Range out of bounds: ${range}`);\n      }\n\n      return { start: startValue, end: endValue };\n    }\n\n    return {\n      start: this.parseBoundedValue(range, min, max, range),\n      end: max,\n    };\n  }\n\n  /**\n   * \u6574\u6570\u5024\u3092\u30D1\u30FC\u30B9\u3057\u3001\u6307\u5B9A\u3055\u308C\u305F\u7BC4\u56F2\u5185\u3067\u3042\u308B\u3053\u3068\u3092\u691C\u8A3C\u3059\u308B\u3002\n   * @param value \u30D1\u30FC\u30B9\u5BFE\u8C61\u306E\u6587\u5B57\u5217\n   * @param min \u8A31\u5BB9\u3055\u308C\u308B\u6700\u5C0F\u5024\n   * @param max \u8A31\u5BB9\u3055\u308C\u308B\u6700\u5927\u5024\n   * @param label \u30A8\u30E9\u30FC\u30E1\u30C3\u30BB\u30FC\u30B8\u7528\u306E\u30E9\u30D9\u30EB\u6587\u5B57\u5217\n   * @returns \u30D1\u30FC\u30B9\u6E08\u307F\u306E\u6574\u6570\u5024\n   * @throws {InvalidArgumentError} \u5024\u304C\u7121\u52B9\u307E\u305F\u306F\u7BC4\u56F2\u5916\u306E\u5834\u5408\n   */\n  private parseBoundedValue(\n    value: string,\n    min: number,\n    max: number,\n    label: string,\n  ): number {\n    const parsed = parseInt(value, BASE_10);\n\n    if (Number.isNaN(parsed)) {\n      throw new InvalidArgumentError(`Invalid range: ${label}`);\n    }\n\n    if (parsed < min || parsed > max) {\n      throw new InvalidArgumentError(`Range out of bounds: ${label}`);\n    }\n\n    return parsed;\n  }\n\n  /**\n   * \u6307\u5B9A\u3055\u308C\u305F\u30B9\u30C6\u30C3\u30D7\u9593\u9694\u3067\u7BC4\u56F2\u5185\u306E\u5024\u3092\u30BB\u30C3\u30C8\u306B\u8FFD\u52A0\u3059\u308B\u3002\n   * @param values \u5024\u3092\u8FFD\u52A0\u3059\u308B\u30BB\u30C3\u30C8\n   * @param start \u7BC4\u56F2\u306E\u958B\u59CB\u5024\n   * @param end \u7BC4\u56F2\u306E\u7D42\u4E86\u5024\n   * @param step \u30B9\u30C6\u30C3\u30D7\u9593\u9694\n   * @param min \u30D5\u30A3\u30FC\u30EB\u30C9\u306E\u6700\u5C0F\u8A31\u5BB9\u5024\n   * @param max \u30D5\u30A3\u30FC\u30EB\u30C9\u306E\u6700\u5927\u8A31\u5BB9\u5024\n   */\n  private addRange(\n    values: Set<number>,\n    start: number,\n    end: number,\n    step: number,\n    min: number,\n    max: number,\n  ): void {\n    for (let i = start; i <= end; i += step) {\n      if (i >= min && i <= max) {\n        values.add(i);\n      }\n    }\n  }\n\n  /**\n   * \u6700\u5C0F\u5024\u304B\u3089\u6700\u5927\u5024\u307E\u3067\u306E\u9023\u7D9A\u3057\u305F\u6574\u6570\u914D\u5217\u3092\u751F\u6210\u3059\u308B\u3002\n   * @param min \u7BC4\u56F2\u306E\u958B\u59CB\u5024\n   * @param max \u7BC4\u56F2\u306E\u7D42\u4E86\u5024\n   * @returns \u9023\u7D9A\u3057\u305F\u6574\u6570\u306E\u914D\u5217\n   */\n  private buildRange(min: number, max: number): number[] {\n    const values: number[] = [];\n    for (let i = min; i <= max; i++) {\n      values.push(i);\n    }\n    return values;\n  }\n\n  /**\n   * \u30BB\u30C3\u30C8\u3092\u6607\u9806\u306B\u30BD\u30FC\u30C8\u3055\u308C\u305F\u914D\u5217\u306B\u5909\u63DB\u3059\u308B\u3002\n   * @param values \u5909\u63DB\u5BFE\u8C61\u306E\u30BB\u30C3\u30C8\n   * @returns \u30BD\u30FC\u30C8\u6E08\u307F\u306E\u6570\u5024\u914D\u5217\n   */\n  private sortedValues(values: Set<number>): number[] {\n    return Array.from(values).sort((a, b) => a - b);\n  }\n\n  /**\n   * Returns true when the date matches the cron fields.\n   */\n  public matches(date: Date): boolean {\n    return (\n      this.fields.minute.includes(date.getMinutes()) &&\n      this.fields.hour.includes(date.getHours()) &&\n      this.fields.dayOfMonth.includes(date.getDate()) &&\n      this.fields.month.includes(date.getMonth() + MONTH_OFFSET) &&\n      this.fields.dayOfWeek.includes(date.getDay())\n    );\n  }\n\n  /**\n   * Returns the next execution time after the given date.\n   * Seconds and milliseconds are cleared before searching.\n   */\n  public getNextExecution(after: Date = new Date()): Date {\n    const next = new Date(after);\n    next.setSeconds(RESET_SECONDS, RESET_MILLISECONDS);\n    next.setMinutes(next.getMinutes() + NEXT_MINUTE_INCREMENT);\n\n    let iterations = 0;\n\n    while (iterations < Cron.MAX_ITERATIONS) {\n      const month = next.getMonth() + MONTH_OFFSET;\n      if (!this.fields.month.includes(month)) {\n        const { value, carry } = this.nextAllowedValue(\n          this.fields.month,\n          month,\n        );\n        if (carry) {\n          next.setFullYear(next.getFullYear() + NEXT_YEAR_INCREMENT);\n        }\n        next.setMonth(value - MONTH_OFFSET, 1);\n        next.setHours(\n          RESET_HOURS,\n          RESET_MINUTES,\n          RESET_SECONDS,\n          RESET_MILLISECONDS,\n        );\n        iterations++;\n        continue;\n      }\n\n      if (!this.matchesDay(next)) {\n        next.setDate(next.getDate() + NEXT_DAY_INCREMENT);\n        next.setHours(\n          RESET_HOURS,\n          RESET_MINUTES,\n          RESET_SECONDS,\n          RESET_MILLISECONDS,\n        );\n        iterations++;\n        continue;\n      }\n\n      const hour = next.getHours();\n      if (!this.fields.hour.includes(hour)) {\n        const { value, carry } = this.nextAllowedValue(this.fields.hour, hour);\n        if (carry) {\n          next.setDate(next.getDate() + NEXT_DAY_INCREMENT);\n        }\n        next.setHours(value, RESET_MINUTES, RESET_SECONDS, RESET_MILLISECONDS);\n        iterations++;\n        continue;\n      }\n\n      const minute = next.getMinutes();\n      if (!this.fields.minute.includes(minute)) {\n        const { value, carry } = this.nextAllowedValue(\n          this.fields.minute,\n          minute,\n        );\n        if (carry) {\n          next.setHours(\n            next.getHours() + NEXT_HOUR_INCREMENT,\n            value,\n            RESET_SECONDS,\n            RESET_MILLISECONDS,\n          );\n        } else {\n          next.setMinutes(value, RESET_SECONDS, RESET_MILLISECONDS);\n        }\n        iterations++;\n        continue;\n      }\n\n      return next;\n    }\n\n    if (iterations >= Cron.MAX_ITERATIONS) {\n      throw new RuntimeError(\n        `Could not find next execution time within ${LOOKAHEAD_YEARS} years`,\n      );\n    }\n\n    return next;\n  }\n\n  /**\n   * Returns a shallow copy of the parsed fields.\n   */\n  public getFields(): CronFields {\n    return { ...this.fields };\n  }\n\n  /**\n   * \u6307\u5B9A\u3055\u308C\u305F\u65E5\u4ED8\u304CdayOfMonth\u3068dayOfWeek\u306E\u4E21\u65B9\u306B\u4E00\u81F4\u3059\u308B\u304B\u5224\u5B9A\u3059\u308B\u3002\n   * @param date \u5224\u5B9A\u5BFE\u8C61\u306E\u65E5\u4ED8\n   * @returns \u4E21\u30D5\u30A3\u30FC\u30EB\u30C9\u306B\u4E00\u81F4\u3059\u308B\u5834\u5408true\n   */\n  private matchesDay(date: Date): boolean {\n    return (\n      this.fields.dayOfMonth.includes(date.getDate()) &&\n      this.fields.dayOfWeek.includes(date.getDay())\n    );\n  }\n\n  /**\n   * \u30BD\u30FC\u30C8\u6E08\u307F\u30EA\u30B9\u30C8\u304B\u3089\u73FE\u5728\u5024\u4EE5\u4E0A\u306E\u6B21\u306E\u8A31\u5BB9\u5024\u3092\u63A2\u3059\u3002\n   * \u73FE\u5728\u5024\u4EE5\u4E0A\u306E\u5024\u304C\u898B\u3064\u304B\u3089\u306A\u3044\u5834\u5408\u3001\u30EA\u30B9\u30C8\u306E\u5148\u982D\u306B\u623B\u308A\u30AD\u30E3\u30EA\u30FC\u30D5\u30E9\u30B0\u3092true\u306B\u3059\u308B\u3002\n   * @param values \u30BD\u30FC\u30C8\u6E08\u307F\u306E\u8A31\u5BB9\u5024\u30EA\u30B9\u30C8\n   * @param current \u73FE\u5728\u306E\u5024\n   * @returns \u6B21\u306E\u8A31\u5BB9\u5024\u3068\u30AD\u30E3\u30EA\u30FC\u30D5\u30E9\u30B0\u3092\u542B\u3080\u30AA\u30D6\u30B8\u30A7\u30AF\u30C8\n   */\n  private nextAllowedValue(\n    values: number[],\n    current: number,\n  ): { value: number; carry: boolean } {\n    for (const value of values) {\n      if (value >= current) {\n        return { value, carry: false };\n      }\n    }\n\n    return { value: values[0], carry: true };\n  }\n}\n", "import type { DistributedLock, LockHandle } from \"../core/lock.js\";\nimport type { CronScheduler } from \"../orchestrator/orchestrator.js\";\n\nconst DEFAULT_LOCK_KEY = \"tokiwa:locks:cron\";\nconst DEFAULT_LOCK_TTL_MS = 60_000;\nconst DEFAULT_REFRESH_INTERVAL_MS = 20_000;\nconst DEFAULT_RETRY_INTERVAL_MS = 5_000;\n\nexport interface LeaderSchedulerOptions {\n  scheduler: CronScheduler;\n  lock: DistributedLock;\n  lockKey?: string;\n  lockTtlMs?: number;\n  refreshIntervalMs?: number;\n  retryIntervalMs?: number;\n}\n\n/**\n * \u5206\u6563\u30EA\u30FC\u30C0\u30FC\u9078\u51FA\u6A5F\u80FD\u3092\u5099\u3048\u305FCronScheduler\u30E9\u30C3\u30D1\u30FC\u3002\n * \u30ED\u30C3\u30AF\u3092\u53D6\u5F97\u3057\u305F\u30A4\u30F3\u30B9\u30BF\u30F3\u30B9\u306E\u307F\u304C\u30B8\u30E7\u30D6\u3092\u5B9F\u884C\u3057\u3001\u30ED\u30C3\u30AF\u55AA\u5931\u6642\u306F\u81EA\u52D5\u7684\u306B\u30EA\u30FC\u30C0\u30FC\u30B7\u30C3\u30D7\u3092\u518D\u53D6\u5F97\u3059\u308B\u3002\n */\nexport class LeaderScheduler implements CronScheduler {\n  private readonly scheduler: CronScheduler;\n  private readonly lock: DistributedLock;\n  private readonly lockKey: string;\n  private readonly lockTtlMs: number;\n  private readonly refreshIntervalMs: number;\n  private readonly retryIntervalMs: number;\n  private running = false;\n  private leaderHandle: LockHandle | null = null;\n  private refreshTimer: ReturnType<typeof setInterval> | null = null;\n  private retryTimer: ReturnType<typeof setTimeout> | null = null;\n  private schedulerStarted = false;\n\n  /**\n   * \u30B9\u30B1\u30B8\u30E5\u30FC\u30E9\u30FC\u3001\u30ED\u30C3\u30AF\u3001\u30BF\u30A4\u30DF\u30F3\u30B0\u30AA\u30D7\u30B7\u30E7\u30F3\u3067\u521D\u671F\u5316\u3059\u308B\u3002\n   * @param options \u30B9\u30B1\u30B8\u30E5\u30FC\u30E9\u30FC\u3001\u30ED\u30C3\u30AF\u3001\u304A\u3088\u3073\u30BF\u30A4\u30DF\u30F3\u30B0\u8A2D\u5B9A\u3092\u542B\u3080\u30AA\u30D7\u30B7\u30E7\u30F3\n   */\n  constructor(options: LeaderSchedulerOptions) {\n    this.scheduler = options.scheduler;\n    this.lock = options.lock;\n    this.lockKey = options.lockKey ?? DEFAULT_LOCK_KEY;\n    this.lockTtlMs = options.lockTtlMs ?? DEFAULT_LOCK_TTL_MS;\n    this.refreshIntervalMs =\n      options.refreshIntervalMs ?? DEFAULT_REFRESH_INTERVAL_MS;\n    this.retryIntervalMs = options.retryIntervalMs ?? DEFAULT_RETRY_INTERVAL_MS;\n  }\n\n  /**\n   * \u30EA\u30FC\u30C0\u30FC\u9078\u51FA\u3092\u958B\u59CB\u3059\u308B\u3002\u30ED\u30C3\u30AF\u306E\u53D6\u5F97\u3092\u8A66\u307F\u3001\u6210\u529F\u3059\u308C\u3070\u30B9\u30B1\u30B8\u30E5\u30FC\u30E9\u30FC\u3092\u8D77\u52D5\u3059\u308B\u3002\n   */\n  async start(): Promise<void> {\n    if (this.running) {\n      return;\n    }\n\n    this.running = true;\n    await this.tryAcquire();\n  }\n\n  /**\n   * \u30B9\u30B1\u30B8\u30E5\u30FC\u30E9\u30FC\u3092\u505C\u6B62\u3057\u3001\u30EA\u30FC\u30C0\u30FC\u30B7\u30C3\u30D7\u3092\u89E3\u653E\u3059\u308B\u3002\n   */\n  async stop(): Promise<void> {\n    this.running = false;\n    this.clearRetry();\n    await this.stopLeader();\n  }\n\n  /**\n   * \u5185\u90E8\u30B9\u30B1\u30B8\u30E5\u30FC\u30E9\u30FC\u306B\u30B8\u30E7\u30D6\u3092\u8FFD\u52A0\u3059\u308B\u3002\n   * @param id \u30B8\u30E7\u30D6\u306E\u4E00\u610F\u8B58\u5225\u5B50\n   * @param cronExpression cron\u5F0F\u6587\u5B57\u5217\n   * @param handler \u30B8\u30E7\u30D6\u5B9F\u884C\u6642\u306B\u547C\u3073\u51FA\u3055\u308C\u308B\u30CF\u30F3\u30C9\u30E9\u30FC\n   * @param name \u30B8\u30E7\u30D6\u306E\u8868\u793A\u540D\uFF08\u7701\u7565\u53EF\uFF09\n   */\n  addJob(\n    id: string,\n    cronExpression: string,\n    handler: () => void | Promise<void>,\n    name?: string,\n  ): void {\n    this.scheduler.addJob(id, cronExpression, handler, name);\n  }\n\n  /**\n   * \u5185\u90E8\u30B9\u30B1\u30B8\u30E5\u30FC\u30E9\u30FC\u304B\u3089\u30B8\u30E7\u30D6\u3092\u524A\u9664\u3059\u308B\u3002\n   * @param id \u524A\u9664\u5BFE\u8C61\u306E\u30B8\u30E7\u30D6ID\n   * @returns \u30B8\u30E7\u30D6\u304C\u5B58\u5728\u3057\u524A\u9664\u3055\u308C\u305F\u5834\u5408true\n   */\n  removeJob(id: string): boolean {\n    return this.scheduler.removeJob(id);\n  }\n\n  /**\n   * \u6307\u5B9A\u3055\u308C\u305FID\u306E\u30B8\u30E7\u30D6\u304C\u767B\u9332\u3055\u308C\u3066\u3044\u308B\u304B\u78BA\u8A8D\u3059\u308B\u3002\n   * @param id \u78BA\u8A8D\u5BFE\u8C61\u306E\u30B8\u30E7\u30D6ID\n   * @returns \u30B8\u30E7\u30D6\u304C\u767B\u9332\u3055\u308C\u3066\u3044\u308B\u5834\u5408true\n   */\n  isJobScheduled(id: string): boolean {\n    return this.scheduler.isJobScheduled(id);\n  }\n\n  /**\n   * \u30EA\u30FC\u30C0\u30FC\u30B7\u30C3\u30D7\u30ED\u30C3\u30AF\u306E\u53D6\u5F97\u3092\u8A66\u307F\u308B\u3002\u53D6\u5F97\u6210\u529F\u6642\u306F\u30EA\u30FC\u30C0\u30FC\u3068\u3057\u3066\u8D77\u52D5\u3057\u3001\u5931\u6557\u6642\u306F\u30EA\u30C8\u30E9\u30A4\u3092\u30B9\u30B1\u30B8\u30E5\u30FC\u30EB\u3059\u308B\u3002\n   */\n  private async tryAcquire(): Promise<void> {\n    if (!this.running) {\n      return;\n    }\n\n    const handle = await this.lock.acquire(this.lockKey, {\n      ttlMs: this.lockTtlMs,\n    });\n\n    if (!handle) {\n      this.scheduleRetry();\n      return;\n    }\n\n    this.leaderHandle = handle;\n    this.startLeader();\n  }\n\n  /**\n   * \u5185\u90E8\u30B9\u30B1\u30B8\u30E5\u30FC\u30E9\u30FC\u3092\u8D77\u52D5\u3057\u3001\u30ED\u30C3\u30AF\u306E\u30EA\u30D5\u30EC\u30C3\u30B7\u30E5\u30BF\u30A4\u30DE\u30FC\u3092\u958B\u59CB\u3059\u308B\u3002\n   */\n  private startLeader(): void {\n    if (this.schedulerStarted) {\n      return;\n    }\n\n    this.scheduler.start();\n    this.schedulerStarted = true;\n\n    if (this.refreshIntervalMs > 0 && this.lock.refresh) {\n      this.refreshTimer = setInterval(() => {\n        void this.refresh();\n      }, this.refreshIntervalMs);\n    }\n  }\n\n  /**\n   * \u30ED\u30C3\u30AF\u306ETTL\u3092\u30EA\u30D5\u30EC\u30C3\u30B7\u30E5\u3059\u308B\u3002\u30EA\u30D5\u30EC\u30C3\u30B7\u30E5\u306B\u5931\u6557\u3057\u305F\u5834\u5408\u306F\u964D\u683C\u51E6\u7406\u3092\u884C\u3046\u3002\n   */\n  private async refresh(): Promise<void> {\n    if (!this.leaderHandle || !this.lock.refresh) {\n      return;\n    }\n\n    const ok = await this.lock.refresh(this.leaderHandle, this.lockTtlMs);\n    if (!ok) {\n      await this.demote();\n    }\n  }\n\n  /**\n   * \u30EA\u30FC\u30C0\u30FC\u30B7\u30C3\u30D7\u3092\u653E\u68C4\u3059\u308B\u3002\u30B9\u30B1\u30B8\u30E5\u30FC\u30E9\u30FC\u3092\u505C\u6B62\u3057\u3001\u30ED\u30C3\u30AF\u3092\u89E3\u653E\u3057\u305F\u5F8C\u3001\u30EA\u30FC\u30C0\u30FC\u30B7\u30C3\u30D7\u306E\u518D\u53D6\u5F97\u3092\u8A66\u307F\u308B\u3002\n   */\n  private async demote(): Promise<void> {\n    if (!this.leaderHandle) {\n      return;\n    }\n\n    const handle = this.leaderHandle;\n    this.leaderHandle = null;\n\n    this.stopRefresh();\n    if (this.schedulerStarted) {\n      await this.scheduler.stop();\n      this.schedulerStarted = false;\n    }\n\n    await this.lock.release(handle);\n\n    if (this.running) {\n      this.scheduleRetry();\n    }\n  }\n\n  /**\n   * \u30ED\u30C3\u30AF\u53D6\u5F97\u306E\u30EA\u30C8\u30E9\u30A4\u3092retryIntervalMs\u5F8C\u306B\u30B9\u30B1\u30B8\u30E5\u30FC\u30EB\u3059\u308B\u3002\n   */\n  private scheduleRetry(): void {\n    if (!this.running) {\n      return;\n    }\n\n    this.clearRetry();\n    this.retryTimer = setTimeout(() => {\n      void this.tryAcquire();\n    }, this.retryIntervalMs);\n  }\n\n  /**\n   * \u30EA\u30C8\u30E9\u30A4\u30BF\u30A4\u30DE\u30FC\u3092\u30AF\u30EA\u30A2\u3059\u308B\u3002\n   */\n  private clearRetry(): void {\n    if (this.retryTimer) {\n      clearTimeout(this.retryTimer);\n      this.retryTimer = null;\n    }\n  }\n\n  /**\n   * \u30EA\u30D5\u30EC\u30C3\u30B7\u30E5\u30BF\u30A4\u30DE\u30FC\u3092\u30AF\u30EA\u30A2\u3059\u308B\u3002\n   */\n  private stopRefresh(): void {\n    if (this.refreshTimer) {\n      clearInterval(this.refreshTimer);\n      this.refreshTimer = null;\n    }\n  }\n\n  /**\n   * \u30B9\u30B1\u30B8\u30E5\u30FC\u30E9\u30FC\u3092\u505C\u6B62\u3057\u3001\u30ED\u30C3\u30AF\u3092\u89E3\u653E\u3057\u3066\u30EA\u30FC\u30C0\u30FC\u30B7\u30C3\u30D7\u3092\u7D42\u4E86\u3059\u308B\u3002\n   */\n  private async stopLeader(): Promise<void> {\n    this.stopRefresh();\n    if (this.schedulerStarted) {\n      await this.scheduler.stop();\n      this.schedulerStarted = false;\n    }\n    if (this.leaderHandle) {\n      await this.lock.release(this.leaderHandle);\n      this.leaderHandle = null;\n    }\n  }\n}\n", "import { Logger } from \"../core/logger.js\";\nimport { Cron } from \"./cron.js\";\n\ntype JobHandler = () => void | Promise<void>;\n\ninterface Job {\n  id: string;\n  cron: Cron;\n  handler: JobHandler;\n  name?: string;\n}\n\nconst MILLISECONDS_PER_SECOND = 1_000;\nconst SECONDS_PER_MINUTE = 60;\nconst MILLISECONDS_PER_MINUTE = MILLISECONDS_PER_SECOND * SECONDS_PER_MINUTE;\nconst DEFAULT_CHECK_INTERVAL_MS = MILLISECONDS_PER_MINUTE;\nconst MIN_CHECK_INTERVAL_MS = 1;\nconst RESET_SECONDS = 0;\nconst RESET_MILLISECONDS = 0;\nconst NEXT_MINUTE_INCREMENT = 1;\n\nexport interface SchedulerLogger {\n  error(message: string, context?: Record<string, unknown>): void;\n}\n\nexport interface SchedulerOptions {\n  checkIntervalMs?: number;\n  logger?: SchedulerLogger;\n}\n\n/**\n * Runs cron jobs on minute boundaries using local time.\n * When checkIntervalMs is set, it checks at a fixed interval and avoids duplicate runs per minute.\n */\nexport class Scheduler {\n  private readonly jobs = new Map<string, Job>();\n  private timerId: ReturnType<typeof setTimeout> | null = null;\n  private isRunning = false;\n  private checkIntervalMs: number = DEFAULT_CHECK_INTERVAL_MS;\n  private readonly logger: SchedulerLogger;\n  private readonly inFlight = new Set<Promise<void>>();\n  private readonly lastRunKeyByJob = new Map<string, string>();\n\n  /**\n   * @param options Default is minute boundary scheduling.\n   */\n  constructor(options: SchedulerOptions | number = {}) {\n    if (typeof options === \"number\") {\n      this.checkIntervalMs = options;\n      this.logger = new Logger({ level: \"error\" });\n    } else {\n      this.checkIntervalMs =\n        options.checkIntervalMs ?? DEFAULT_CHECK_INTERVAL_MS;\n      this.logger = options.logger ?? new Logger({ level: \"error\" });\n    }\n\n    this.checkIntervalMs = Math.max(\n      MIN_CHECK_INTERVAL_MS,\n      this.checkIntervalMs,\n    );\n  }\n\n  /**\n   * Adds or replaces a job by id.\n   */\n  public addJob(\n    id: string,\n    cronExpression: string,\n    handler: JobHandler,\n    name?: string,\n  ): void {\n    const cron = new Cron(cronExpression);\n    const job: Job = { id, cron, handler, name };\n    this.jobs.set(id, job);\n    this.lastRunKeyByJob.delete(id);\n  }\n\n  /**\n   * Removes a job by id.\n   */\n  public removeJob(id: string): boolean {\n    this.lastRunKeyByJob.delete(id);\n    return this.jobs.delete(id);\n  }\n\n  /**\n   * Returns a job by id, if present.\n   */\n  public getJob(id: string): Job | undefined {\n    return this.jobs.get(id);\n  }\n\n  /**\n   * Returns all registered jobs.\n   */\n  public getAllJobs(): Job[] {\n    return Array.from(this.jobs.values());\n  }\n\n  /**\n   * Starts scheduling if not already running.\n   */\n  public start(): void {\n    if (this.isRunning) {\n      return;\n    }\n\n    this.isRunning = true;\n    this.scheduleNextCheck();\n  }\n\n  /**\n   * Stops scheduling and clears the pending timer.\n   */\n  public async stop(): Promise<void> {\n    if (!this.isRunning) {\n      return;\n    }\n\n    this.isRunning = false;\n    this.clearTimer();\n    await this.waitForInFlight();\n  }\n\n  /**\n   * \u6B21\u306E\u30BF\u30A4\u30DE\u30FC\u30C6\u30A3\u30C3\u30AF\u3092\u30B9\u30B1\u30B8\u30E5\u30FC\u30EB\u3059\u308B\u3002\n   * \u30C7\u30D5\u30A9\u30EB\u30C8\u9593\u9694\u306E\u5834\u5408\u306F\u6B21\u306E\u5206\u5883\u754C\u307E\u3067\u3001\u305D\u308C\u4EE5\u5916\u306FcheckIntervalMs\u3067\u5F85\u6A5F\u3059\u308B\u3002\n   */\n  private scheduleNextCheck(): void {\n    if (!this.isRunning) {\n      return;\n    }\n\n    const delay =\n      this.checkIntervalMs === DEFAULT_CHECK_INTERVAL_MS\n        ? Scheduler.getDelayUntilNextMinute(new Date())\n        : this.checkIntervalMs;\n    this.timerId = setTimeout(this.handleTick, delay);\n  }\n\n  /**\n   * \u30BF\u30A4\u30DE\u30FC\u30B3\u30FC\u30EB\u30D0\u30C3\u30AF\u3002\u30B8\u30E7\u30D6\u306E\u5B9F\u884C\u30C1\u30A7\u30C3\u30AF\u3092\u884C\u3044\u3001\u6B21\u306E\u30C6\u30A3\u30C3\u30AF\u3092\u518D\u30B9\u30B1\u30B8\u30E5\u30FC\u30EB\u3059\u308B\u3002\n   */\n  private handleTick = (): void => {\n    void this.checkAndExecuteJobs();\n    this.scheduleNextCheck();\n  };\n\n  /**\n   * \u5168\u30B8\u30E7\u30D6\u3092\u73FE\u5728\u6642\u523B\u3068\u7167\u5408\u3057\u3001\u4E00\u81F4\u3059\u308B\u30B8\u30E7\u30D6\u3092\u5B9F\u884C\u3059\u308B\u3002\n   * \u540C\u4E00\u5206\u5185\u3067\u306E\u91CD\u8907\u5B9F\u884C\u3092\u9632\u6B62\u3059\u308B\u305F\u3081\u30DF\u30CB\u30C3\u30C8\u30AD\u30FC\u3067\u7BA1\u7406\u3059\u308B\u3002\n   */\n  private async checkAndExecuteJobs(): Promise<void> {\n    const now = new Date();\n    const minuteKey = Scheduler.buildMinuteKey(now);\n    const tasks: Promise<void>[] = [];\n\n    for (const job of this.jobs.values()) {\n      if (!job.cron.matches(now)) {\n        continue;\n      }\n\n      if (this.lastRunKeyByJob.get(job.id) === minuteKey) {\n        continue;\n      }\n\n      this.lastRunKeyByJob.set(job.id, minuteKey);\n      tasks.push(this.runJob(job));\n    }\n\n    if (tasks.length > 0) {\n      await Promise.allSettled(tasks);\n    }\n  }\n\n  /**\n   * \u4FDD\u7559\u4E2D\u306EsetTimeout\u30BF\u30A4\u30DE\u30FC\u3092\u30AF\u30EA\u30A2\u3059\u308B\u3002\n   */\n  private clearTimer(): void {\n    if (this.timerId) {\n      clearTimeout(this.timerId);\n      this.timerId = null;\n    }\n  }\n\n  /**\n   * \u30B8\u30E7\u30D6\u306E\u30CF\u30F3\u30C9\u30E9\u30FC\u3092\u5B9F\u884C\u3057\u3001\u30A8\u30E9\u30FC\u767A\u751F\u6642\u306F\u30ED\u30B0\u306B\u8A18\u9332\u3059\u308B\u3002\n   * \u5B9F\u884C\u4E2D\u306E\u30B8\u30E7\u30D6\u306FinFlight\u30BB\u30C3\u30C8\u3067\u8FFD\u8DE1\u3055\u308C\u308B\u3002\n   * @param job \u5B9F\u884C\u5BFE\u8C61\u306E\u30B8\u30E7\u30D6\n   * @returns \u30B8\u30E7\u30D6\u5B8C\u4E86\u3092\u8868\u3059Promise\n   */\n  private runJob(job: Job): Promise<void> {\n    const task = (async () => {\n      try {\n        await job.handler();\n      } catch (error: unknown) {\n        this.logger.error(`Error executing job ${job.id}`, {\n          jobId: job.id,\n          name: job.name,\n          error,\n        });\n      }\n    })();\n\n    this.inFlight.add(task);\n    task.finally(() => {\n      this.inFlight.delete(task);\n    });\n\n    return task;\n  }\n\n  /**\n   * \u5B9F\u884C\u4E2D\u306E\u5168\u30B8\u30E7\u30D6\u304C\u5B8C\u4E86\u3059\u308B\u307E\u3067\u5F85\u6A5F\u3059\u308B\u3002\n   */\n  private async waitForInFlight(): Promise<void> {\n    if (this.inFlight.size === 0) {\n      return;\n    }\n    await Promise.allSettled(this.inFlight);\n  }\n\n  /**\n   * \u73FE\u5728\u6642\u523B\u304B\u3089\u6B21\u306E\u5206\u5883\u754C\u307E\u3067\u306E\u30DF\u30EA\u79D2\u6570\u3092\u8A08\u7B97\u3059\u308B\u3002\n   * @param now \u73FE\u5728\u6642\u523B\n   * @returns \u6B21\u306E\u5206\u5883\u754C\u307E\u3067\u306E\u30DF\u30EA\u79D2\u6570\n   */\n  private static getDelayUntilNextMinute(now: Date): number {\n    const nextMinute = new Date(now);\n    nextMinute.setSeconds(RESET_SECONDS, RESET_MILLISECONDS);\n    nextMinute.setMinutes(nextMinute.getMinutes() + NEXT_MINUTE_INCREMENT);\n    return nextMinute.getTime() - now.getTime();\n  }\n\n  /**\n   * \u6307\u5B9A\u3055\u308C\u305F\u65E5\u6642\u304B\u3089\u5206\u5358\u4F4D\u306E\u4E00\u610F\u30AD\u30FC\u3092\u751F\u6210\u3059\u308B\u3002\u91CD\u8907\u5B9F\u884C\u9632\u6B62\u306B\u4F7F\u7528\u3055\u308C\u308B\u3002\n   * @param date \u30AD\u30FC\u751F\u6210\u5BFE\u8C61\u306E\u65E5\u6642\n   * @returns \"\u5E74-\u6708-\u65E5-\u6642-\u5206\" \u5F62\u5F0F\u306E\u6587\u5B57\u5217\u30AD\u30FC\n   */\n  private static buildMinuteKey(date: Date): string {\n    return [\n      date.getFullYear(),\n      date.getMonth(),\n      date.getDate(),\n      date.getHours(),\n      date.getMinutes(),\n    ].join(\"-\");\n  }\n\n  /**\n   * Returns the next execution time for a job, or null if missing.\n   */\n  public getNextExecutionTime(jobId: string): Date | null {\n    const job = this.jobs.get(jobId);\n    if (!job) {\n      return null;\n    }\n\n    return job.cron.getNextExecution();\n  }\n\n  /**\n   * Returns true when a job id is registered.\n   */\n  public isJobScheduled(jobId: string): boolean {\n    return this.jobs.has(jobId);\n  }\n}\n"],
  "mappings": ";AAIO,IAAM,WAAN,cAAuB,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA,EAKlC,YAAY,SAAiB,UAAwB,CAAC,GAAG;AACvD,UAAM,SAAS,OAAO;AACtB,SAAK,OAAO,KAAK,YAAY;AAAA,EAC/B;AACF;AAGO,IAAM,uBAAN,cAAmC,SAAS;AAAC;AAG7C,IAAM,eAAN,cAA2B,SAAS;AAAC;;;ACnBrC,IAAM,YAAY;AAAA,EACvB,WAAW;AAAA,EACX,OAAO;AAAA,EACP,UAAU;AAAA,EACV,OAAO;AAAA,EACP,SAAS;AAAA,EACT,QAAQ;AAAA,EACR,MAAM;AAAA,EACN,OAAO;AACT;AAkBA,IAAM,oBAA8B;AACpC,IAAM,6BAA6B;AAEnC,IAAM,mBAGF;AAAA,EACF,WAAW;AAAA,EACX,OAAO;AAAA,EACP,UAAU;AAAA,EACV,OAAO;AAAA,EACP,SAAS;AAAA,EACT,QAAQ;AAAA,EACR,MAAM;AAAA,EACN,OAAO;AACT;AAEA,IAAM,gBAAgB,CAAC,UAA2B;AAChD,MAAI;AACF,WAAO,KAAK,UAAU,KAAK;AAAA,EAC7B,QAAQ;AACN,WAAO;AAAA,EACT;AACF;AAEA,IAAM,oBAAoB,MAAe;AACvC,SAAO,CAAC,UAA0B;AAChC,UAAM,SAAS,iBAAiB,MAAM,KAAK;AAC3C,UAAM,YAAY,MAAM,UAAU,YAAY;AAC9C,UAAM,cAAc,MAAM,UAAU,IAAI,cAAc,MAAM,OAAO,CAAC,KAAK;AACzE,YAAQ,MAAM;AAAA,MACZ,IAAI,SAAS,KAAK,MAAM,KAAK,KAAK,MAAM,OAAO,GAAG,WAAW;AAAA,IAC/D;AAAA,EACF;AACF;AAMO,IAAM,SAAN,MAAa;AAAA,EACV,QAAkB;AAAA,EAClB,aAAqB,UAAU,iBAAiB;AAAA,EAChD,OAAgB,kBAAkB;AAAA;AAAA;AAAA;AAAA,EAK1C,YAAY,UAAyB,CAAC,GAAG;AACvC,QAAI,QAAQ,OAAO;AACjB,WAAK,SAAS,QAAQ,KAAK;AAAA,IAC7B;AACA,QAAI,QAAQ,MAAM;AAChB,WAAK,QAAQ,QAAQ,IAAI;AAAA,IAC3B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,SAAS,OAAuB;AAC9B,SAAK,QAAQ;AACb,SAAK,aAAa,UAAU,KAAK;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,WAAqB;AACnB,WAAO,KAAK;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,QAAQ,MAAqB;AAC3B,SAAK,OAAO;AAAA,EACd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,IACE,OACA,SACA,SACM;AACN,QAAI,UAAU,KAAK,IAAI,KAAK,YAAY;AACtC;AAAA,IACF;AACA,SAAK,KAAK,EAAE,OAAO,SAAS,WAAW,oBAAI,KAAK,GAAG,QAAQ,CAAC;AAAA,EAC9D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,UAAU,SAAiB,SAAyC;AAClE,SAAK,IAAI,aAAa,SAAS,OAAO;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAM,SAAiB,SAAyC;AAC9D,SAAK,IAAI,SAAS,SAAS,OAAO;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,SAAS,SAAiB,SAAyC;AACjE,SAAK,IAAI,YAAY,SAAS,OAAO;AAAA,EACvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAM,SAAiB,SAAyC;AAC9D,SAAK,IAAI,SAAS,SAAS,OAAO;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,QAAQ,SAAiB,SAAyC;AAChE,SAAK,IAAI,WAAW,SAAS,OAAO;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,OAAO,SAAiB,SAAyC;AAC/D,SAAK,IAAI,UAAU,SAAS,OAAO;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,KAAK,SAAiB,SAAyC;AAC7D,SAAK,IAAI,QAAQ,SAAS,OAAO;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAM,SAAiB,SAAyC;AAC9D,SAAK,IAAI,SAAS,SAAS,OAAO;AAAA,EACpC;AACF;;;AC/KA,IAAM,mBAAiD;AAAA,EACrD,EAAE,KAAK,UAAU,KAAK,GAAG,KAAK,GAAG;AAAA,EACjC,EAAE,KAAK,QAAQ,KAAK,GAAG,KAAK,GAAG;AAAA,EAC/B,EAAE,KAAK,cAAc,KAAK,GAAG,KAAK,GAAG;AAAA,EACrC,EAAE,KAAK,SAAS,KAAK,GAAG,KAAK,GAAG;AAAA,EAChC,EAAE,KAAK,aAAa,KAAK,GAAG,KAAK,EAAE;AACrC;AAEA,IAAM,mBAAmB,iBAAiB;AAC1C,IAAM,UAAU;AAChB,IAAM,iBAAiB;AACvB,IAAM,qBAAqB;AAC3B,IAAM,wBAAwB;AAC9B,IAAM,sBAAsB;AAC5B,IAAM,qBAAqB;AAC3B,IAAM,sBAAsB;AAC5B,IAAM,eAAe;AACrB,IAAM,cAAc;AACpB,IAAM,gBAAgB;AACtB,IAAM,gBAAgB;AACtB,IAAM,qBAAqB;AAC3B,IAAM,kBAAkB;AACxB,IAAM,gBAAgB;AACtB,IAAM,gBAAgB;AACtB,IAAM,mBAAmB;AACzB,IAAM,sBACJ,kBAAkB,gBAAgB,gBAAgB;AAK7C,IAAM,OAAN,MAAM,MAAK;AAAA,EAChB,OAAwB,iBAAiB;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKjB,YAAY,YAAoB;AAC9B,SAAK,SAAS,KAAK,MAAM,UAAU;AAAA,EACrC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOQ,MAAM,YAAgC;AAC5C,UAAM,QAAQ,WAAW,KAAK,EAAE,MAAM,KAAK;AAE3C,QAAI,MAAM,WAAW,kBAAkB;AACrC,YAAM,IAAI;AAAA,QACR;AAAA,MACF;AAAA,IACF;AAEA,UAAM,SAAyC;AAAA,MAC7C,QAAQ,CAAC;AAAA,MACT,MAAM,CAAC;AAAA,MACP,YAAY,CAAC;AAAA,MACb,OAAO,CAAC;AAAA,MACR,WAAW,CAAC;AAAA,IACd;AAEA,qBAAiB,QAAQ,CAAC,MAAM,UAAU;AACxC,aAAO,KAAK,GAAG,IAAI,KAAK,WAAW,MAAM,KAAK,GAAG,KAAK,KAAK,KAAK,GAAG;AAAA,IACrE,CAAC;AAED,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASQ,WAAW,OAAe,KAAa,KAAuB;AACpE,QAAI,UAAU,KAAK;AACjB,aAAO,KAAK,WAAW,KAAK,GAAG;AAAA,IACjC;AAEA,UAAM,SAAS,oBAAI,IAAY;AAC/B,UAAM,QAAQ,MAAM,MAAM,GAAG;AAE7B,eAAW,QAAQ,OAAO;AACxB,WAAK,eAAe,MAAM,KAAK,KAAK,MAAM;AAAA,IAC5C;AAEA,WAAO,KAAK,aAAa,MAAM;AAAA,EACjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUQ,eACN,MACA,KACA,KACA,QACM;AACN,QAAI,KAAK,SAAS,GAAG,GAAG;AACtB,YAAM,CAAC,OAAO,IAAI,IAAI,KAAK,MAAM,GAAG;AACpC,YAAM,YAAY,KAAK,eAAe,IAAI;AAC1C,YAAM,EAAE,OAAO,IAAI,IAAI,KAAK,eAAe,OAAO,KAAK,GAAG;AAC1D,WAAK,SAAS,QAAQ,OAAO,KAAK,WAAW,KAAK,GAAG;AACrD;AAAA,IACF;AAEA,QAAI,KAAK,SAAS,GAAG,GAAG;AACtB,YAAM,CAAC,OAAO,GAAG,IAAI,KAAK,MAAM,GAAG;AACnC,YAAM,aAAa,SAAS,OAAO,OAAO;AAC1C,YAAM,WAAW,SAAS,KAAK,OAAO;AAEtC,UAAI,OAAO,MAAM,UAAU,KAAK,OAAO,MAAM,QAAQ,GAAG;AACtD,cAAM,IAAI,qBAAqB,kBAAkB,IAAI,EAAE;AAAA,MACzD;AAEA,UAAI,aAAa,OAAO,WAAW,OAAO,aAAa,UAAU;AAC/D,cAAM,IAAI,qBAAqB,wBAAwB,IAAI,EAAE;AAAA,MAC/D;AAEA,WAAK,SAAS,QAAQ,YAAY,UAAU,oBAAoB,KAAK,GAAG;AACxE;AAAA,IACF;AAEA,UAAM,QAAQ,SAAS,MAAM,OAAO;AAEpC,QAAI,OAAO,MAAM,KAAK,GAAG;AACvB,YAAM,IAAI,qBAAqB,kBAAkB,IAAI,EAAE;AAAA,IACzD;AAEA,QAAI,QAAQ,OAAO,QAAQ,KAAK;AAC9B,YAAM,IAAI;AAAA,QACR,wBAAwB,KAAK,qBAAqB,GAAG,QAAQ,GAAG;AAAA,MAClE;AAAA,IACF;AAEA,WAAO,IAAI,KAAK;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQQ,eAAe,MAAsB;AAC3C,UAAM,YAAY,SAAS,MAAM,OAAO;AAExC,QAAI,OAAO,MAAM,SAAS,KAAK,YAAY,gBAAgB;AACzD,YAAM,IAAI,qBAAqB,uBAAuB,IAAI,EAAE;AAAA,IAC9D;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASQ,eACN,OACA,KACA,KACgC;AAChC,QAAI,UAAU,KAAK;AACjB,aAAO,EAAE,OAAO,KAAK,KAAK,IAAI;AAAA,IAChC;AAEA,QAAI,MAAM,SAAS,GAAG,GAAG;AACvB,YAAM,CAAC,OAAO,GAAG,IAAI,MAAM,MAAM,GAAG;AACpC,YAAM,aAAa,KAAK,kBAAkB,OAAO,KAAK,KAAK,KAAK;AAChE,YAAM,WAAW,KAAK,kBAAkB,KAAK,KAAK,KAAK,KAAK;AAE5D,UAAI,aAAa,UAAU;AACzB,cAAM,IAAI,qBAAqB,wBAAwB,KAAK,EAAE;AAAA,MAChE;AAEA,aAAO,EAAE,OAAO,YAAY,KAAK,SAAS;AAAA,IAC5C;AAEA,WAAO;AAAA,MACL,OAAO,KAAK,kBAAkB,OAAO,KAAK,KAAK,KAAK;AAAA,MACpD,KAAK;AAAA,IACP;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWQ,kBACN,OACA,KACA,KACA,OACQ;AACR,UAAM,SAAS,SAAS,OAAO,OAAO;AAEtC,QAAI,OAAO,MAAM,MAAM,GAAG;AACxB,YAAM,IAAI,qBAAqB,kBAAkB,KAAK,EAAE;AAAA,IAC1D;AAEA,QAAI,SAAS,OAAO,SAAS,KAAK;AAChC,YAAM,IAAI,qBAAqB,wBAAwB,KAAK,EAAE;AAAA,IAChE;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWQ,SACN,QACA,OACA,KACA,MACA,KACA,KACM;AACN,aAAS,IAAI,OAAO,KAAK,KAAK,KAAK,MAAM;AACvC,UAAI,KAAK,OAAO,KAAK,KAAK;AACxB,eAAO,IAAI,CAAC;AAAA,MACd;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQQ,WAAW,KAAa,KAAuB;AACrD,UAAM,SAAmB,CAAC;AAC1B,aAAS,IAAI,KAAK,KAAK,KAAK,KAAK;AAC/B,aAAO,KAAK,CAAC;AAAA,IACf;AACA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOQ,aAAa,QAA+B;AAClD,WAAO,MAAM,KAAK,MAAM,EAAE,KAAK,CAAC,GAAG,MAAM,IAAI,CAAC;AAAA,EAChD;AAAA;AAAA;AAAA;AAAA,EAKO,QAAQ,MAAqB;AAClC,WACE,KAAK,OAAO,OAAO,SAAS,KAAK,WAAW,CAAC,KAC7C,KAAK,OAAO,KAAK,SAAS,KAAK,SAAS,CAAC,KACzC,KAAK,OAAO,WAAW,SAAS,KAAK,QAAQ,CAAC,KAC9C,KAAK,OAAO,MAAM,SAAS,KAAK,SAAS,IAAI,YAAY,KACzD,KAAK,OAAO,UAAU,SAAS,KAAK,OAAO,CAAC;AAAA,EAEhD;AAAA;AAAA;AAAA;AAAA;AAAA,EAMO,iBAAiB,QAAc,oBAAI,KAAK,GAAS;AACtD,UAAM,OAAO,IAAI,KAAK,KAAK;AAC3B,SAAK,WAAW,eAAe,kBAAkB;AACjD,SAAK,WAAW,KAAK,WAAW,IAAI,qBAAqB;AAEzD,QAAI,aAAa;AAEjB,WAAO,aAAa,MAAK,gBAAgB;AACvC,YAAM,QAAQ,KAAK,SAAS,IAAI;AAChC,UAAI,CAAC,KAAK,OAAO,MAAM,SAAS,KAAK,GAAG;AACtC,cAAM,EAAE,OAAO,MAAM,IAAI,KAAK;AAAA,UAC5B,KAAK,OAAO;AAAA,UACZ;AAAA,QACF;AACA,YAAI,OAAO;AACT,eAAK,YAAY,KAAK,YAAY,IAAI,mBAAmB;AAAA,QAC3D;AACA,aAAK,SAAS,QAAQ,cAAc,CAAC;AACrC,aAAK;AAAA,UACH;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QACF;AACA;AACA;AAAA,MACF;AAEA,UAAI,CAAC,KAAK,WAAW,IAAI,GAAG;AAC1B,aAAK,QAAQ,KAAK,QAAQ,IAAI,kBAAkB;AAChD,aAAK;AAAA,UACH;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QACF;AACA;AACA;AAAA,MACF;AAEA,YAAM,OAAO,KAAK,SAAS;AAC3B,UAAI,CAAC,KAAK,OAAO,KAAK,SAAS,IAAI,GAAG;AACpC,cAAM,EAAE,OAAO,MAAM,IAAI,KAAK,iBAAiB,KAAK,OAAO,MAAM,IAAI;AACrE,YAAI,OAAO;AACT,eAAK,QAAQ,KAAK,QAAQ,IAAI,kBAAkB;AAAA,QAClD;AACA,aAAK,SAAS,OAAO,eAAe,eAAe,kBAAkB;AACrE;AACA;AAAA,MACF;AAEA,YAAM,SAAS,KAAK,WAAW;AAC/B,UAAI,CAAC,KAAK,OAAO,OAAO,SAAS,MAAM,GAAG;AACxC,cAAM,EAAE,OAAO,MAAM,IAAI,KAAK;AAAA,UAC5B,KAAK,OAAO;AAAA,UACZ;AAAA,QACF;AACA,YAAI,OAAO;AACT,eAAK;AAAA,YACH,KAAK,SAAS,IAAI;AAAA,YAClB;AAAA,YACA;AAAA,YACA;AAAA,UACF;AAAA,QACF,OAAO;AACL,eAAK,WAAW,OAAO,eAAe,kBAAkB;AAAA,QAC1D;AACA;AACA;AAAA,MACF;AAEA,aAAO;AAAA,IACT;AAEA,QAAI,cAAc,MAAK,gBAAgB;AACrC,YAAM,IAAI;AAAA,QACR,6CAA6C,eAAe;AAAA,MAC9D;AAAA,IACF;AAEA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKO,YAAwB;AAC7B,WAAO,EAAE,GAAG,KAAK,OAAO;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOQ,WAAW,MAAqB;AACtC,WACE,KAAK,OAAO,WAAW,SAAS,KAAK,QAAQ,CAAC,KAC9C,KAAK,OAAO,UAAU,SAAS,KAAK,OAAO,CAAC;AAAA,EAEhD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASQ,iBACN,QACA,SACmC;AACnC,eAAW,SAAS,QAAQ;AAC1B,UAAI,SAAS,SAAS;AACpB,eAAO,EAAE,OAAO,OAAO,MAAM;AAAA,MAC/B;AAAA,IACF;AAEA,WAAO,EAAE,OAAO,OAAO,CAAC,GAAG,OAAO,KAAK;AAAA,EACzC;AACF;;;AC7aA,IAAM,mBAAmB;AACzB,IAAM,sBAAsB;AAC5B,IAAM,8BAA8B;AACpC,IAAM,4BAA4B;AAe3B,IAAM,kBAAN,MAA+C;AAAA,EACnC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACT,UAAU;AAAA,EACV,eAAkC;AAAA,EAClC,eAAsD;AAAA,EACtD,aAAmD;AAAA,EACnD,mBAAmB;AAAA;AAAA;AAAA;AAAA;AAAA,EAM3B,YAAY,SAAiC;AAC3C,SAAK,YAAY,QAAQ;AACzB,SAAK,OAAO,QAAQ;AACpB,SAAK,UAAU,QAAQ,WAAW;AAClC,SAAK,YAAY,QAAQ,aAAa;AACtC,SAAK,oBACH,QAAQ,qBAAqB;AAC/B,SAAK,kBAAkB,QAAQ,mBAAmB;AAAA,EACpD;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,QAAuB;AAC3B,QAAI,KAAK,SAAS;AAChB;AAAA,IACF;AAEA,SAAK,UAAU;AACf,UAAM,KAAK,WAAW;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,OAAsB;AAC1B,SAAK,UAAU;AACf,SAAK,WAAW;AAChB,UAAM,KAAK,WAAW;AAAA,EACxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,OACE,IACA,gBACA,SACA,MACM;AACN,SAAK,UAAU,OAAO,IAAI,gBAAgB,SAAS,IAAI;AAAA,EACzD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,UAAU,IAAqB;AAC7B,WAAO,KAAK,UAAU,UAAU,EAAE;AAAA,EACpC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,eAAe,IAAqB;AAClC,WAAO,KAAK,UAAU,eAAe,EAAE;AAAA,EACzC;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,aAA4B;AACxC,QAAI,CAAC,KAAK,SAAS;AACjB;AAAA,IACF;AAEA,UAAM,SAAS,MAAM,KAAK,KAAK,QAAQ,KAAK,SAAS;AAAA,MACnD,OAAO,KAAK;AAAA,IACd,CAAC;AAED,QAAI,CAAC,QAAQ;AACX,WAAK,cAAc;AACnB;AAAA,IACF;AAEA,SAAK,eAAe;AACpB,SAAK,YAAY;AAAA,EACnB;AAAA;AAAA;AAAA;AAAA,EAKQ,cAAoB;AAC1B,QAAI,KAAK,kBAAkB;AACzB;AAAA,IACF;AAEA,SAAK,UAAU,MAAM;AACrB,SAAK,mBAAmB;AAExB,QAAI,KAAK,oBAAoB,KAAK,KAAK,KAAK,SAAS;AACnD,WAAK,eAAe,YAAY,MAAM;AACpC,aAAK,KAAK,QAAQ;AAAA,MACpB,GAAG,KAAK,iBAAiB;AAAA,IAC3B;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,UAAyB;AACrC,QAAI,CAAC,KAAK,gBAAgB,CAAC,KAAK,KAAK,SAAS;AAC5C;AAAA,IACF;AAEA,UAAM,KAAK,MAAM,KAAK,KAAK,QAAQ,KAAK,cAAc,KAAK,SAAS;AACpE,QAAI,CAAC,IAAI;AACP,YAAM,KAAK,OAAO;AAAA,IACpB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,SAAwB;AACpC,QAAI,CAAC,KAAK,cAAc;AACtB;AAAA,IACF;AAEA,UAAM,SAAS,KAAK;AACpB,SAAK,eAAe;AAEpB,SAAK,YAAY;AACjB,QAAI,KAAK,kBAAkB;AACzB,YAAM,KAAK,UAAU,KAAK;AAC1B,WAAK,mBAAmB;AAAA,IAC1B;AAEA,UAAM,KAAK,KAAK,QAAQ,MAAM;AAE9B,QAAI,KAAK,SAAS;AAChB,WAAK,cAAc;AAAA,IACrB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,gBAAsB;AAC5B,QAAI,CAAC,KAAK,SAAS;AACjB;AAAA,IACF;AAEA,SAAK,WAAW;AAChB,SAAK,aAAa,WAAW,MAAM;AACjC,WAAK,KAAK,WAAW;AAAA,IACvB,GAAG,KAAK,eAAe;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA,EAKQ,aAAmB;AACzB,QAAI,KAAK,YAAY;AACnB,mBAAa,KAAK,UAAU;AAC5B,WAAK,aAAa;AAAA,IACpB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,cAAoB;AAC1B,QAAI,KAAK,cAAc;AACrB,oBAAc,KAAK,YAAY;AAC/B,WAAK,eAAe;AAAA,IACtB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,aAA4B;AACxC,SAAK,YAAY;AACjB,QAAI,KAAK,kBAAkB;AACzB,YAAM,KAAK,UAAU,KAAK;AAC1B,WAAK,mBAAmB;AAAA,IAC1B;AACA,QAAI,KAAK,cAAc;AACrB,YAAM,KAAK,KAAK,QAAQ,KAAK,YAAY;AACzC,WAAK,eAAe;AAAA,IACtB;AAAA,EACF;AACF;;;ACxNA,IAAM,0BAA0B;AAChC,IAAM,qBAAqB;AAC3B,IAAM,0BAA0B,0BAA0B;AAC1D,IAAM,4BAA4B;AAClC,IAAM,wBAAwB;AAC9B,IAAMA,iBAAgB;AACtB,IAAMC,sBAAqB;AAC3B,IAAMC,yBAAwB;AAevB,IAAM,YAAN,MAAM,WAAU;AAAA,EACJ,OAAO,oBAAI,IAAiB;AAAA,EACrC,UAAgD;AAAA,EAChD,YAAY;AAAA,EACZ,kBAA0B;AAAA,EACjB;AAAA,EACA,WAAW,oBAAI,IAAmB;AAAA,EAClC,kBAAkB,oBAAI,IAAoB;AAAA;AAAA;AAAA;AAAA,EAK3D,YAAY,UAAqC,CAAC,GAAG;AACnD,QAAI,OAAO,YAAY,UAAU;AAC/B,WAAK,kBAAkB;AACvB,WAAK,SAAS,IAAI,OAAO,EAAE,OAAO,QAAQ,CAAC;AAAA,IAC7C,OAAO;AACL,WAAK,kBACH,QAAQ,mBAAmB;AAC7B,WAAK,SAAS,QAAQ,UAAU,IAAI,OAAO,EAAE,OAAO,QAAQ,CAAC;AAAA,IAC/D;AAEA,SAAK,kBAAkB,KAAK;AAAA,MAC1B;AAAA,MACA,KAAK;AAAA,IACP;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKO,OACL,IACA,gBACA,SACA,MACM;AACN,UAAM,OAAO,IAAI,KAAK,cAAc;AACpC,UAAM,MAAW,EAAE,IAAI,MAAM,SAAS,KAAK;AAC3C,SAAK,KAAK,IAAI,IAAI,GAAG;AACrB,SAAK,gBAAgB,OAAO,EAAE;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA,EAKO,UAAU,IAAqB;AACpC,SAAK,gBAAgB,OAAO,EAAE;AAC9B,WAAO,KAAK,KAAK,OAAO,EAAE;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA,EAKO,OAAO,IAA6B;AACzC,WAAO,KAAK,KAAK,IAAI,EAAE;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA,EAKO,aAAoB;AACzB,WAAO,MAAM,KAAK,KAAK,KAAK,OAAO,CAAC;AAAA,EACtC;AAAA;AAAA;AAAA;AAAA,EAKO,QAAc;AACnB,QAAI,KAAK,WAAW;AAClB;AAAA,IACF;AAEA,SAAK,YAAY;AACjB,SAAK,kBAAkB;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA,EAKA,MAAa,OAAsB;AACjC,QAAI,CAAC,KAAK,WAAW;AACnB;AAAA,IACF;AAEA,SAAK,YAAY;AACjB,SAAK,WAAW;AAChB,UAAM,KAAK,gBAAgB;AAAA,EAC7B;AAAA;AAAA;AAAA;AAAA;AAAA,EAMQ,oBAA0B;AAChC,QAAI,CAAC,KAAK,WAAW;AACnB;AAAA,IACF;AAEA,UAAM,QACJ,KAAK,oBAAoB,4BACrB,WAAU,wBAAwB,oBAAI,KAAK,CAAC,IAC5C,KAAK;AACX,SAAK,UAAU,WAAW,KAAK,YAAY,KAAK;AAAA,EAClD;AAAA;AAAA;AAAA;AAAA,EAKQ,aAAa,MAAY;AAC/B,SAAK,KAAK,oBAAoB;AAC9B,SAAK,kBAAkB;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAc,sBAAqC;AACjD,UAAM,MAAM,oBAAI,KAAK;AACrB,UAAM,YAAY,WAAU,eAAe,GAAG;AAC9C,UAAM,QAAyB,CAAC;AAEhC,eAAW,OAAO,KAAK,KAAK,OAAO,GAAG;AACpC,UAAI,CAAC,IAAI,KAAK,QAAQ,GAAG,GAAG;AAC1B;AAAA,MACF;AAEA,UAAI,KAAK,gBAAgB,IAAI,IAAI,EAAE,MAAM,WAAW;AAClD;AAAA,MACF;AAEA,WAAK,gBAAgB,IAAI,IAAI,IAAI,SAAS;AAC1C,YAAM,KAAK,KAAK,OAAO,GAAG,CAAC;AAAA,IAC7B;AAEA,QAAI,MAAM,SAAS,GAAG;AACpB,YAAM,QAAQ,WAAW,KAAK;AAAA,IAChC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKQ,aAAmB;AACzB,QAAI,KAAK,SAAS;AAChB,mBAAa,KAAK,OAAO;AACzB,WAAK,UAAU;AAAA,IACjB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQQ,OAAO,KAAyB;AACtC,UAAM,QAAQ,YAAY;AACxB,UAAI;AACF,cAAM,IAAI,QAAQ;AAAA,MACpB,SAAS,OAAgB;AACvB,aAAK,OAAO,MAAM,uBAAuB,IAAI,EAAE,IAAI;AAAA,UACjD,OAAO,IAAI;AAAA,UACX,MAAM,IAAI;AAAA,UACV;AAAA,QACF,CAAC;AAAA,MACH;AAAA,IACF,GAAG;AAEH,SAAK,SAAS,IAAI,IAAI;AACtB,SAAK,QAAQ,MAAM;AACjB,WAAK,SAAS,OAAO,IAAI;AAAA,IAC3B,CAAC;AAED,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA,EAKA,MAAc,kBAAiC;AAC7C,QAAI,KAAK,SAAS,SAAS,GAAG;AAC5B;AAAA,IACF;AACA,UAAM,QAAQ,WAAW,KAAK,QAAQ;AAAA,EACxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,OAAe,wBAAwB,KAAmB;AACxD,UAAM,aAAa,IAAI,KAAK,GAAG;AAC/B,eAAW,WAAWF,gBAAeC,mBAAkB;AACvD,eAAW,WAAW,WAAW,WAAW,IAAIC,sBAAqB;AACrE,WAAO,WAAW,QAAQ,IAAI,IAAI,QAAQ;AAAA,EAC5C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,OAAe,eAAe,MAAoB;AAChD,WAAO;AAAA,MACL,KAAK,YAAY;AAAA,MACjB,KAAK,SAAS;AAAA,MACd,KAAK,QAAQ;AAAA,MACb,KAAK,SAAS;AAAA,MACd,KAAK,WAAW;AAAA,IAClB,EAAE,KAAK,GAAG;AAAA,EACZ;AAAA;AAAA;AAAA;AAAA,EAKO,qBAAqB,OAA4B;AACtD,UAAM,MAAM,KAAK,KAAK,IAAI,KAAK;AAC/B,QAAI,CAAC,KAAK;AACR,aAAO;AAAA,IACT;AAEA,WAAO,IAAI,KAAK,iBAAiB;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA,EAKO,eAAe,OAAwB;AAC5C,WAAO,KAAK,KAAK,IAAI,KAAK;AAAA,EAC5B;AACF;",
  "names": ["RESET_SECONDS", "RESET_MILLISECONDS", "NEXT_MINUTE_INCREMENT"]
}
