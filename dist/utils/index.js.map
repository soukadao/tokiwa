{
  "version": 3,
  "sources": ["../../src/core/errors.ts", "../../src/utils/exec-async.ts", "../../src/utils/command.ts", "../../src/utils/performance.ts"],
  "sourcesContent": ["/**\n * \u30A2\u30D7\u30EA\u30B1\u30FC\u30B7\u30E7\u30F3\u5171\u901A\u306E\u57FA\u5E95\u30A8\u30E9\u30FC\u30AF\u30E9\u30B9\n * \u30B5\u30D6\u30AF\u30E9\u30B9\u540D\u3092\u81EA\u52D5\u7684\u306Bname\u30D7\u30ED\u30D1\u30C6\u30A3\u306B\u8A2D\u5B9A\u3059\u308B\n */\nexport class AppError extends Error {\n  /**\n   * @param message \u30A8\u30E9\u30FC\u30E1\u30C3\u30BB\u30FC\u30B8\n   * @param options \u30A8\u30E9\u30FC\u30AA\u30D7\u30B7\u30E7\u30F3\uFF08cause\u306A\u3069\uFF09\n   */\n  constructor(message: string, options: ErrorOptions = {}) {\n    super(message, options);\n    this.name = this.constructor.name;\n  }\n}\n\n/** \u7121\u52B9\u306A\u5F15\u6570\u304C\u6E21\u3055\u308C\u305F\u5834\u5408\u306E\u30A8\u30E9\u30FC */\nexport class InvalidArgumentError extends AppError {}\n\n/** \u5B9F\u884C\u6642\u30A8\u30E9\u30FC */\nexport class RuntimeError extends AppError {}\n\n/** \u30EA\u30BD\u30FC\u30B9\u304C\u898B\u3064\u304B\u3089\u306A\u3044\u5834\u5408\u306E\u30A8\u30E9\u30FC */\nexport class NotFoundError extends AppError {}\n\n/** \u30EA\u30BD\u30FC\u30B9\u306E\u7AF6\u5408\u304C\u767A\u751F\u3057\u305F\u5834\u5408\u306E\u30A8\u30E9\u30FC */\nexport class ConflictError extends AppError {}\n\n/** \u4E0D\u6B63\u306A\u72B6\u614B\u3067\u64CD\u4F5C\u304C\u5B9F\u884C\u3055\u308C\u305F\u5834\u5408\u306E\u30A8\u30E9\u30FC */\nexport class StateError extends AppError {}\n\n/** \u4F9D\u5B58\u95A2\u4FC2\u306B\u554F\u984C\u304C\u3042\u308B\u5834\u5408\u306E\u30A8\u30E9\u30FC */\nexport class DependencyError extends AppError {}\n\n/** \u5FAA\u74B0\u4F9D\u5B58\u304C\u691C\u51FA\u3055\u308C\u305F\u5834\u5408\u306E\u30A8\u30E9\u30FC */\nexport class CyclicDependencyError extends DependencyError {}\n\n/** \u30B7\u30EA\u30A2\u30E9\u30A4\u30BA/\u30C7\u30B7\u30EA\u30A2\u30E9\u30A4\u30BA\u306B\u5931\u6557\u3057\u305F\u5834\u5408\u306E\u30A8\u30E9\u30FC */\nexport class SerializationError extends AppError {}\n", "import {\n  type ExecFileOptions,\n  type ExecOptions,\n  exec,\n  execFile,\n} from \"node:child_process\";\nimport { promisify } from \"node:util\";\nimport { InvalidArgumentError } from \"../core/index.js\";\n\nconst DEFAULT_ENCODING: BufferEncoding = \"utf8\";\nconst SHELL_EXEC_DISABLED_MESSAGE =\n  \"Shell execution is disabled. Pass { allowShell: true } to execAsync.\";\n\nexport interface ExecResult {\n  stdout: string;\n  stderr: string;\n}\n\nexport interface ExecAsyncOptions extends ExecOptions {\n  allowShell?: boolean;\n}\n\nconst execAsyncRaw = promisify(exec);\nconst execFileAsyncRaw = promisify(execFile);\n\nconst normalizeOutput = (value: string | Buffer | undefined): string => {\n  if (typeof value === \"string\") {\n    return value;\n  }\n  if (value) {\n    return value.toString(DEFAULT_ENCODING);\n  }\n  return \"\";\n};\n\n/**\n * NOTE: Executes through a shell. Prefer execFileAsync when possible.\n * allowShell \u3092\u660E\u793A\u3057\u306A\u3044\u9650\u308A\u5B9F\u884C\u3055\u308C\u307E\u305B\u3093\u3002\n */\nexport const execAsync = async (\n  command: string,\n  options: ExecAsyncOptions = {},\n): Promise<ExecResult> => {\n  if (!options.allowShell) {\n    throw new InvalidArgumentError(SHELL_EXEC_DISABLED_MESSAGE);\n  }\n  const { allowShell: _allowShell, ...execOptions } = options;\n  const { stdout, stderr } = await execAsyncRaw(command, {\n    encoding: DEFAULT_ENCODING,\n    ...execOptions,\n  });\n  return { stdout: normalizeOutput(stdout), stderr: normalizeOutput(stderr) };\n};\n\n/**\n * \u30B7\u30A7\u30EB\u3092\u4ECB\u3055\u305A\u306B\u30D5\u30A1\u30A4\u30EB\u3092\u76F4\u63A5\u5B9F\u884C\u3059\u308B\n * @param file \u5B9F\u884C\u3059\u308B\u30D5\u30A1\u30A4\u30EB\u30D1\u30B9\n * @param args \u30B3\u30DE\u30F3\u30C9\u30E9\u30A4\u30F3\u5F15\u6570\n * @param options \u5B9F\u884C\u30AA\u30D7\u30B7\u30E7\u30F3\n * @returns \u6A19\u6E96\u51FA\u529B\u3068\u6A19\u6E96\u30A8\u30E9\u30FC\u51FA\u529B\n */\nexport const execFileAsync = async (\n  file: string,\n  args: readonly string[] = [],\n  options: ExecFileOptions = {},\n): Promise<ExecResult> => {\n  const { stdout, stderr } = await execFileAsyncRaw(file, args, {\n    encoding: DEFAULT_ENCODING,\n    ...options,\n  });\n  return { stdout: normalizeOutput(stdout), stderr: normalizeOutput(stderr) };\n};\n", "import { RuntimeError } from \"../core/index.js\";\nimport { execFileAsync } from \"./exec-async.js\";\n\nconst formatCommand = (command: string, args: readonly string[]): string =>\n  [command, ...args].join(\" \");\n\ntype ExecError = Error & { stderr?: string | Buffer; code?: number };\n\nconst isExecError = (error: unknown): error is ExecError =>\n  error instanceof Error && (\"stderr\" in error || \"code\" in error);\n\n/**\n * \u5916\u90E8\u30B3\u30DE\u30F3\u30C9\u3092\u5B9F\u884C\u3057\u3001\u6A19\u6E96\u51FA\u529B\u3092\u8FD4\u3059\n * \u30B7\u30A7\u30EB\u3092\u4ECB\u3055\u305A\u5B89\u5168\u306B\u30B3\u30DE\u30F3\u30C9\u3092\u5B9F\u884C\u3059\u308B\n * @param command \u5B9F\u884C\u3059\u308B\u30B3\u30DE\u30F3\u30C9\n * @param args \u30B3\u30DE\u30F3\u30C9\u30E9\u30A4\u30F3\u5F15\u6570\n * @returns \u6A19\u6E96\u51FA\u529B\u306E\u6587\u5B57\u5217\n * @throws {RuntimeError} \u30B3\u30DE\u30F3\u30C9\u306E\u5B9F\u884C\u306B\u5931\u6557\u3057\u305F\u5834\u5408\n */\nexport const execCommand = async (\n  command: string,\n  args: readonly string[] = [],\n): Promise<string> => {\n  const commandText = formatCommand(command, args);\n\n  try {\n    const { stdout } = await execFileAsync(command, args);\n    return stdout;\n  } catch (error: unknown) {\n    if (isExecError(error)) {\n      const stderr =\n        typeof error.stderr === \"string\"\n          ? error.stderr\n          : (error.stderr?.toString() ?? \"\");\n\n      throw new RuntimeError(\n        `Command failed: ${commandText}\\nExit code: ${error.code}\\n${stderr}`,\n      );\n    }\n\n    throw new RuntimeError(`Command failed: ${commandText}\\n${error}`);\n  }\n};\n", "import { performance } from \"node:perf_hooks\";\n\nconst DEFAULT_MEASUREMENT_TIMES = 10_000;\n\n/**\n * \u95A2\u6570\u306E\u5B9F\u884C\u6642\u9593\u3092\u8A08\u6E2C\u3059\u308B\n * @param fn \u8A08\u6E2C\u5BFE\u8C61\u306E\u95A2\u6570\n * @returns \u5B9F\u884C\u7D50\u679C\u3068\u7D4C\u904E\u6642\u9593\uFF08\u30DF\u30EA\u79D2\uFF09\n */\nexport const runPerformance = <T>(fn: () => T): { result: T; time: number } => {\n  const t0 = performance.now();\n  const result = fn();\n  const t1 = performance.now();\n  const time = t1 - t0;\n\n  return { result, time };\n};\n\n/**\n * \u95A2\u6570\u3092\u8907\u6570\u56DE\u5B9F\u884C\u3057\u3001\u5404\u56DE\u306E\u5B9F\u884C\u6642\u9593\u3092\u53CE\u96C6\u3059\u308B\n * @param fn \u8A08\u6E2C\u5BFE\u8C61\u306E\u95A2\u6570\n * @param times \u5B9F\u884C\u56DE\u6570\uFF08\u30C7\u30D5\u30A9\u30EB\u30C8: 10,000\uFF09\n * @returns \u5404\u56DE\u306E\u5B9F\u884C\u6642\u9593\uFF08\u30DF\u30EA\u79D2\uFF09\u306E\u914D\u5217\n */\nexport const measurePerformance = <T>(\n  fn: () => T,\n  times: number = DEFAULT_MEASUREMENT_TIMES,\n): { times: number[] } => {\n  const resultTimes: number[] = [];\n\n  for (let i = 0; i < times; i++) {\n    const { time } = runPerformance(fn);\n    resultTimes.push(time);\n  }\n\n  return { times: resultTimes };\n};\n"],
  "mappings": ";AAIO,IAAM,WAAN,cAAuB,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA,EAKlC,YAAY,SAAiB,UAAwB,CAAC,GAAG;AACvD,UAAM,SAAS,OAAO;AACtB,SAAK,OAAO,KAAK,YAAY;AAAA,EAC/B;AACF;AAGO,IAAM,uBAAN,cAAmC,SAAS;AAAC;AAG7C,IAAM,eAAN,cAA2B,SAAS;AAAC;;;ACnB5C;AAAA,EAGE;AAAA,EACA;AAAA,OACK;AACP,SAAS,iBAAiB;AAG1B,IAAM,mBAAmC;AACzC,IAAM,8BACJ;AAWF,IAAM,eAAe,UAAU,IAAI;AACnC,IAAM,mBAAmB,UAAU,QAAQ;AAE3C,IAAM,kBAAkB,CAAC,UAA+C;AACtE,MAAI,OAAO,UAAU,UAAU;AAC7B,WAAO;AAAA,EACT;AACA,MAAI,OAAO;AACT,WAAO,MAAM,SAAS,gBAAgB;AAAA,EACxC;AACA,SAAO;AACT;AAMO,IAAM,YAAY,OACvB,SACA,UAA4B,CAAC,MACL;AACxB,MAAI,CAAC,QAAQ,YAAY;AACvB,UAAM,IAAI,qBAAqB,2BAA2B;AAAA,EAC5D;AACA,QAAM,EAAE,YAAY,aAAa,GAAG,YAAY,IAAI;AACpD,QAAM,EAAE,QAAQ,OAAO,IAAI,MAAM,aAAa,SAAS;AAAA,IACrD,UAAU;AAAA,IACV,GAAG;AAAA,EACL,CAAC;AACD,SAAO,EAAE,QAAQ,gBAAgB,MAAM,GAAG,QAAQ,gBAAgB,MAAM,EAAE;AAC5E;AASO,IAAM,gBAAgB,OAC3B,MACA,OAA0B,CAAC,GAC3B,UAA2B,CAAC,MACJ;AACxB,QAAM,EAAE,QAAQ,OAAO,IAAI,MAAM,iBAAiB,MAAM,MAAM;AAAA,IAC5D,UAAU;AAAA,IACV,GAAG;AAAA,EACL,CAAC;AACD,SAAO,EAAE,QAAQ,gBAAgB,MAAM,GAAG,QAAQ,gBAAgB,MAAM,EAAE;AAC5E;;;ACpEA,IAAM,gBAAgB,CAAC,SAAiB,SACtC,CAAC,SAAS,GAAG,IAAI,EAAE,KAAK,GAAG;AAI7B,IAAM,cAAc,CAAC,UACnB,iBAAiB,UAAU,YAAY,SAAS,UAAU;AAUrD,IAAM,cAAc,OACzB,SACA,OAA0B,CAAC,MACP;AACpB,QAAM,cAAc,cAAc,SAAS,IAAI;AAE/C,MAAI;AACF,UAAM,EAAE,OAAO,IAAI,MAAM,cAAc,SAAS,IAAI;AACpD,WAAO;AAAA,EACT,SAAS,OAAgB;AACvB,QAAI,YAAY,KAAK,GAAG;AACtB,YAAM,SACJ,OAAO,MAAM,WAAW,WACpB,MAAM,SACL,MAAM,QAAQ,SAAS,KAAK;AAEnC,YAAM,IAAI;AAAA,QACR,mBAAmB,WAAW;AAAA,aAAgB,MAAM,IAAI;AAAA,EAAK,MAAM;AAAA,MACrE;AAAA,IACF;AAEA,UAAM,IAAI,aAAa,mBAAmB,WAAW;AAAA,EAAK,KAAK,EAAE;AAAA,EACnE;AACF;;;AC1CA,SAAS,mBAAmB;AAE5B,IAAM,4BAA4B;AAO3B,IAAM,iBAAiB,CAAI,OAA6C;AAC7E,QAAM,KAAK,YAAY,IAAI;AAC3B,QAAM,SAAS,GAAG;AAClB,QAAM,KAAK,YAAY,IAAI;AAC3B,QAAM,OAAO,KAAK;AAElB,SAAO,EAAE,QAAQ,KAAK;AACxB;AAQO,IAAM,qBAAqB,CAChC,IACA,QAAgB,8BACQ;AACxB,QAAM,cAAwB,CAAC;AAE/B,WAAS,IAAI,GAAG,IAAI,OAAO,KAAK;AAC9B,UAAM,EAAE,KAAK,IAAI,eAAe,EAAE;AAClC,gBAAY,KAAK,IAAI;AAAA,EACvB;AAEA,SAAO,EAAE,OAAO,YAAY;AAC9B;",
  "names": []
}
